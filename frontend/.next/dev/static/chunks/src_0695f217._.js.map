{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///F:/Projects/gemini-audio-engineer-react/frontend/src/components/Waveform.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useEffect, useMemo, useRef, useState } from \"react\";\nimport WaveSurfer from \"wavesurfer.js\";\nimport RegionsPlugin from \"wavesurfer.js/dist/plugins/regions.esm.js\";\n\n/**\n * Waveform player + region selection (no backend calls).\n * - Loads a local File via object URL\n * - Creates a draggable + resizable region\n * - Emits selection changes up to parent\n */\ninterface WaveformProps {\n  file: File;\n  onSelectionChange?: (selection: { startSec: number; endSec: number; durationSec: number }) => void;\n}\n\nexport default function Waveform({ file, onSelectionChange }: WaveformProps) {\n\n  const containerRef = useRef<HTMLDivElement>(null);\n  const wsRef = useRef<WaveSurfer | null>(null);\n  const regionRef = useRef<any>(null); // RegionsPlugin doesn't always export a 'SingleRegion' type easily\n  const [isReady, setIsReady] = useState(false);\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [duration, setDuration] = useState(0);\n\n  useEffect(() => {\n    if (!containerRef.current || !file) return;\n\n    // 1. Create Object URL locally within the effect\n    const audioUrl = URL.createObjectURL(file);\n\n    // Cleanup any previous instance\n    if (wsRef.current) {\n      wsRef.current.destroy();\n      wsRef.current = null;\n      regionRef.current = null;\n    }\n\n    // Create the Regions plugin instance first\n    const wsRegions = RegionsPlugin.create();\n\n    // Create WaveSurfer\n    const ws = WaveSurfer.create({\n      container: containerRef.current,\n      height: 120,\n      normalize: true,\n      waveColor: \"#475569\",\n      progressColor: \"#818cf8\",\n      cursorColor: \"#2dd4bf\",\n      barWidth: 2,\n      barGap: 3,\n      barRadius: 3,\n      plugins: [wsRegions],\n    });\n\n    wsRef.current = ws;\n\n    ws.on(\"ready\", () => {\n      // Guard: if destroyed in the meantime\n      if (!wsRef.current) return;\n\n      setIsReady(true);\n      const dur = ws.getDuration();\n      setDuration(dur);\n\n      // Default region: full duration (capped at 10 minutes for safety)\n      const start = 0;\n      const end = Math.min(dur, 600);\n\n      // Add region via the plugin instance\n      const r = wsRegions.addRegion({\n        start,\n        end,\n        drag: true,\n        resize: true,\n        color: \"rgba(129, 140, 248, 0.15)\",\n      });\n\n      regionRef.current = r;\n      onSelectionChange?.({ startSec: start, endSec: end, durationSec: dur });\n    });\n\n    ws.on(\"play\", () => setIsPlaying(true));\n    ws.on(\"pause\", () => setIsPlaying(false));\n    ws.on(\"finish\", () => setIsPlaying(false));\n\n    // Listen to region events on the plugin instance\n    wsRegions.on(\"region-updated\", (region: any) => {\n      onSelectionChange?.({\n        startSec: region.start,\n        endSec: region.end,\n        durationSec: ws.getDuration(),\n      });\n    });\n\n    // Ensure we capture the final state after drag ends\n    wsRegions.on(\"region-out\", (region: any) => {\n      onSelectionChange?.({\n        startSec: region.start,\n        endSec: region.end,\n        durationSec: ws.getDuration(),\n      });\n    });\n\n    ws.load(audioUrl);\n\n    return () => {\n      // Cleanup: Destroy WS first, then revoke the URL\n      if (ws) ws.destroy();\n      URL.revokeObjectURL(audioUrl);\n    };\n  }, [file, onSelectionChange]);\n\n  const toggle = () => {\n    if (!wsRef.current) return;\n    wsRef.current.playPause();\n  };\n\n  const playRegion = () => {\n    const ws = wsRef.current;\n    const region = regionRef.current;\n    if (!ws || !region) return;\n    ws.play(region.start, region.end);\n  };\n\n  const selectFull = () => {\n    const ws = wsRef.current;\n    const region = regionRef.current;\n    if (!ws || !region) return;\n    const dur = ws.getDuration();\n    region.setOptions({ start: 0, end: dur });\n    onSelectionChange?.({ startSec: 0, endSec: dur, durationSec: dur });\n  };\n\n  return (\n    <div className=\"stack\">\n      <div ref={containerRef} className=\"card\" />\n      <div className=\"kpi\">\n        <button className=\"btn secondary\" disabled={!isReady} onClick={toggle}>\n          {isPlaying ? \"Pause\" : \"Play/Pause\"}\n        </button>\n        <button className=\"btn secondary\" disabled={!isReady} onClick={playRegion}>\n          Play Selection\n        </button>\n        <button className=\"btn secondary\" disabled={!isReady} onClick={selectFull}>\n          Select Full\n        </button>\n        <span className=\"pill\">Duration: {duration.toFixed(2)}s</span>\n        <span className=\"pill\">Drag/resize region to select</span>\n      </div>\n      <div className=\"muted\">\n        Tip: Default selection is the full song (up to 10 min).\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 244, "column": 0}, "map": {"version":3,"sources":["file:///F:/Projects/gemini-audio-engineer-react/frontend/src/api.ts"],"sourcesContent":["const API_BASE = \"\";\n\n// Helper function to handle response errors safely\nasync function handleResponse(res: Response, defaultMsg: string) {\n  if (!res.ok) {\n    const textBody = await res.text(); // Read stream ONCE\n    try {\n      // Try to parse as JSON to get the \"detail\" field from Python\n      const jsonBody = JSON.parse(textBody);\n      throw new Error(jsonBody.detail || jsonBody.message || textBody);\n    } catch (e: any) {\n      // If JSON parse fails, throw the raw text body\n      // If the thrown error is the one we just threw above, rethrow it\n      if (e.message && !e.message.includes(\"Unexpected token\")) {\n        throw e;\n      }\n      throw new Error(textBody || defaultMsg);\n    }\n  }\n  return res.json();\n}\n\ninterface FetchSpectrogramParams {\n  file: File;\n  startSec: number;\n  endSec: number;\n}\n\nexport async function fetchSpectrogram({ file, startSec, endSec }: FetchSpectrogramParams) {\n  const fd = new FormData();\n  fd.append(\"startSec\", String(startSec));\n  fd.append(\"endSec\", String(endSec));\n  fd.append(\"file\", file);\n\n  const res = await fetch(`${API_BASE}/api/spectrogram`, {\n    method: \"POST\",\n    body: fd,\n  });\n\n  return handleResponse(res, \"Failed to generate spectrogram.\");\n}\n\ninterface AnalyzeAudioParams {\n  file: File;\n  startSec: number;\n  endSec: number;\n  prompt: string;\n  modelId: string;\n  temperature: number;\n  thinkingBudget?: number;\n  mode?: string;\n}\n\nexport async function analyzeAudio({ file, startSec, endSec, prompt, modelId, temperature, thinkingBudget, mode }: AnalyzeAudioParams) {\n  const fd = new FormData();\n  fd.append(\"prompt\", prompt);\n  fd.append(\"modelId\", modelId);\n  fd.append(\"mode\", mode || \"engineer\");\n  fd.append(\"startSec\", String(startSec));\n  fd.append(\"endSec\", String(endSec));\n  fd.append(\"temperature\", String(temperature));\n  if (thinkingBudget) fd.append(\"thinkingBudget\", String(thinkingBudget));\n  fd.append(\"file\", file);\n\n  const res = await fetch(`${API_BASE}/api/analyze`, {\n    method: \"POST\",\n    body: fd,\n  });\n\n  return handleResponse(res, \"Failed to analyze audio.\");\n}\n\nexport async function sendChatMessage(sessionId: string, message: string) {\n  const fd = new FormData();\n  fd.append(\"sessionId\", sessionId);\n  fd.append(\"message\", message);\n\n  const res = await fetch(`${API_BASE}/api/chat`, {\n    method: \"POST\",\n    body: fd,\n  });\n\n  return handleResponse(res, \"Failed to send message.\");\n}\nexport async function startAudioProcessing(file: File, model: string = \"demucs\") {\n  const fd = new FormData();\n  fd.append(\"file\", file);\n  fd.append(\"model\", model);\n\n  const res = await fetch(`${API_BASE}/api/process`, {\n    method: \"POST\",\n    body: fd,\n  });\n\n  return handleResponse(res, \"Failed to start processing job.\");\n}\n\n\nexport async function getJobStatus(jobId: string) {\n  const res = await fetch(`${API_BASE}/api/process/${jobId}`);\n  return handleResponse(res, \"Failed to fetch job status.\");\n}\n\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA,MAAM,WAAW;AAEjB,mDAAmD;AACnD,eAAe,eAAe,GAAa,EAAE,UAAkB;IAC7D,IAAI,CAAC,IAAI,EAAE,EAAE;QACX,MAAM,WAAW,MAAM,IAAI,IAAI,IAAI,mBAAmB;QACtD,IAAI;YACF,6DAA6D;YAC7D,MAAM,WAAW,KAAK,KAAK,CAAC;YAC5B,MAAM,IAAI,MAAM,SAAS,MAAM,IAAI,SAAS,OAAO,IAAI;QACzD,EAAE,OAAO,GAAQ;YACf,+CAA+C;YAC/C,iEAAiE;YACjE,IAAI,EAAE,OAAO,IAAI,CAAC,EAAE,OAAO,CAAC,QAAQ,CAAC,qBAAqB;gBACxD,MAAM;YACR;YACA,MAAM,IAAI,MAAM,YAAY;QAC9B;IACF;IACA,OAAO,IAAI,IAAI;AACjB;AAQO,eAAe,iBAAiB,EAAE,IAAI,EAAE,QAAQ,EAAE,MAAM,EAA0B;IACvF,MAAM,KAAK,IAAI;IACf,GAAG,MAAM,CAAC,YAAY,OAAO;IAC7B,GAAG,MAAM,CAAC,UAAU,OAAO;IAC3B,GAAG,MAAM,CAAC,QAAQ;IAElB,MAAM,MAAM,MAAM,MAAM,GAAG,SAAS,gBAAgB,CAAC,EAAE;QACrD,QAAQ;QACR,MAAM;IACR;IAEA,OAAO,eAAe,KAAK;AAC7B;AAaO,eAAe,aAAa,EAAE,IAAI,EAAE,QAAQ,EAAE,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,WAAW,EAAE,cAAc,EAAE,IAAI,EAAsB;IACnI,MAAM,KAAK,IAAI;IACf,GAAG,MAAM,CAAC,UAAU;IACpB,GAAG,MAAM,CAAC,WAAW;IACrB,GAAG,MAAM,CAAC,QAAQ,QAAQ;IAC1B,GAAG,MAAM,CAAC,YAAY,OAAO;IAC7B,GAAG,MAAM,CAAC,UAAU,OAAO;IAC3B,GAAG,MAAM,CAAC,eAAe,OAAO;IAChC,IAAI,gBAAgB,GAAG,MAAM,CAAC,kBAAkB,OAAO;IACvD,GAAG,MAAM,CAAC,QAAQ;IAElB,MAAM,MAAM,MAAM,MAAM,GAAG,SAAS,YAAY,CAAC,EAAE;QACjD,QAAQ;QACR,MAAM;IACR;IAEA,OAAO,eAAe,KAAK;AAC7B;AAEO,eAAe,gBAAgB,SAAiB,EAAE,OAAe;IACtE,MAAM,KAAK,IAAI;IACf,GAAG,MAAM,CAAC,aAAa;IACvB,GAAG,MAAM,CAAC,WAAW;IAErB,MAAM,MAAM,MAAM,MAAM,GAAG,SAAS,SAAS,CAAC,EAAE;QAC9C,QAAQ;QACR,MAAM;IACR;IAEA,OAAO,eAAe,KAAK;AAC7B;AACO,eAAe,qBAAqB,IAAU,EAAE,QAAgB,QAAQ;IAC7E,MAAM,KAAK,IAAI;IACf,GAAG,MAAM,CAAC,QAAQ;IAClB,GAAG,MAAM,CAAC,SAAS;IAEnB,MAAM,MAAM,MAAM,MAAM,GAAG,SAAS,YAAY,CAAC,EAAE;QACjD,QAAQ;QACR,MAAM;IACR;IAEA,OAAO,eAAe,KAAK;AAC7B;AAGO,eAAe,aAAa,KAAa;IAC9C,MAAM,MAAM,MAAM,MAAM,GAAG,SAAS,aAAa,EAAE,OAAO;IAC1D,OAAO,eAAe,KAAK;AAC7B"}},
    {"offset": {"line": 334, "column": 0}, "map": {"version":3,"sources":["file:///F:/Projects/gemini-audio-engineer-react/frontend/src/components/StemPlayer.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useEffect, useRef, useState, useCallback } from \"react\";\r\nimport WaveSurfer from \"wavesurfer.js\";\r\n\r\ninterface Stem {\r\n    name: string;\r\n    url: string;\r\n}\r\n\r\ninterface StemPlayerProps {\r\n    stems: Stem[];\r\n}\r\n\r\nexport default function StemPlayer({ stems }: StemPlayerProps) {\r\n    const containersRef = useRef<(HTMLDivElement | null)[]>([]);\r\n    const wsInstances = useRef<(WaveSurfer | null)[]>([]);\r\n    const [isPlaying, setIsPlaying] = useState(false);\r\n    const [isReady, setIsReady] = useState<boolean[]>(new Array(stems.length).fill(false));\r\n    const [volumes, setVolumes] = useState<number[]>(new Array(stems.length).fill(1));\r\n    const [mutes, setMutes] = useState<boolean[]>(new Array(stems.length).fill(false));\r\n    const [solos, setSolos] = useState<boolean[]>(new Array(stems.length).fill(false));\r\n\r\n    useEffect(() => {\r\n        // Initialize WaveSurfer for each stem\r\n        stems.forEach((stem, index) => {\r\n            if (!containersRef.current[index]) return;\r\n\r\n            const ws = WaveSurfer.create({\r\n                container: containersRef.current[index]!,\r\n                height: 60,\r\n                progressColor: \"#818cf8\",\r\n                waveColor: \"#475569\",\r\n                barWidth: 2,\r\n                cursorColor: \"#2dd4bf\",\r\n                normalize: true,\r\n            });\r\n\r\n            ws.load(stem.url);\r\n            wsInstances.current[index] = ws;\r\n\r\n            ws.on(\"ready\", () => {\r\n                setIsReady(prev => {\r\n                    const next = [...prev];\r\n                    next[index] = true;\r\n                    return next;\r\n                });\r\n            });\r\n\r\n            // Sync playback across all instances\r\n            ws.on(\"interaction\", () => {\r\n                const time = ws.getCurrentTime();\r\n                wsInstances.current.forEach(inst => inst?.seekTo(time / inst.getDuration()));\r\n            });\r\n        });\r\n\r\n        return () => {\r\n            wsInstances.current.forEach(inst => inst?.destroy());\r\n            wsInstances.current = [];\r\n        };\r\n    }, [stems]);\r\n\r\n    const togglePlay = () => {\r\n        const nextPlaying = !isPlaying;\r\n        setIsPlaying(nextPlaying);\r\n        wsInstances.current.forEach(inst => nextPlaying ? inst?.play() : inst?.pause());\r\n    };\r\n\r\n    const toggleMute = (index: number) => {\r\n        const nextMutes = [...mutes];\r\n        nextMutes[index] = !nextMutes[index];\r\n        setMutes(nextMutes);\r\n        wsInstances.current[index]?.setMuted(nextMutes[index]);\r\n    };\r\n\r\n    const toggleSolo = (index: number) => {\r\n        const nextSolos = [...solos];\r\n        nextSolos[index] = !nextSolos[index];\r\n        setSolos(nextSolos);\r\n\r\n        // If any solo is active, only soloed tracks play.\r\n        // If no solos active, all non-muted tracks play.\r\n        const isAnySolo = nextSolos.some(s => s);\r\n        wsInstances.current.forEach((inst, i) => {\r\n            if (isAnySolo) {\r\n                inst?.setVolume(nextSolos[i] ? volumes[i] : 0);\r\n            } else {\r\n                inst?.setVolume(mutes[i] ? 0 : volumes[i]);\r\n            }\r\n        });\r\n    };\r\n\r\n    const onVolumeChange = (index: number, val: number) => {\r\n        const nextVolumes = [...volumes];\r\n        nextVolumes[index] = val;\r\n        setVolumes(nextVolumes);\r\n        if (!mutes[index] && (!solos.some(s => s) || solos[index])) {\r\n            wsInstances.current[index]?.setVolume(val);\r\n        }\r\n    };\r\n\r\n    const allReady = isReady.every(r => r);\r\n\r\n    return (\r\n        <div className=\"card stack\" style={{ background: 'rgba(15, 23, 42, 0.5)', padding: '20px' }}>\r\n            <div className=\"row\" style={{ justifyContent: 'space-between', alignItems: 'center', marginBottom: '16px' }}>\r\n                <label style={{ color: 'var(--accent-secondary)' }}>üéöÔ∏è Multi-Track Stem Mixer</label>\r\n                <button className=\"btn\" disabled={!allReady} onClick={togglePlay}>\r\n                    {isPlaying ? \"‚èπÔ∏è STOP\" : \"‚ñ∂Ô∏è PLAY ALL\"}\r\n                </button>\r\n            </div>\r\n\r\n            <div className=\"stack\" style={{ gap: '12px' }}>\r\n                {stems.map((stem, i) => (\r\n                    <div key={stem.name} className=\"row\" style={{ gridTemplateColumns: '120px 1fr 180px', gap: '15px', alignItems: 'center', padding: '8px', background: 'rgba(255,255,255,0.03)', borderRadius: '8px' }}>\r\n                        <div style={{ fontSize: '0.75rem', fontWeight: 600, textTransform: 'uppercase' }}>{stem.name}</div>\r\n                        <div ref={el => containersRef.current[i] = el} />\r\n                        <div className=\"row\" style={{ gap: '8px' }}>\r\n                            <button\r\n                                className={`pill ${solos[i] ? 'active' : ''}`}\r\n                                onClick={() => toggleSolo(i)}\r\n                                style={{ background: solos[i] ? '#fbbf24' : 'transparent', color: solos[i] ? '#000' : '#fff' }}\r\n                            >S</button>\r\n                            <button\r\n                                className={`pill ${mutes[i] ? 'active' : ''}`}\r\n                                onClick={() => toggleMute(i)}\r\n                                style={{ background: mutes[i] ? '#ef4444' : 'transparent' }}\r\n                            >M</button>\r\n                            <input\r\n                                type=\"range\"\r\n                                min=\"0\" max=\"1\" step=\"0.01\"\r\n                                value={volumes[i]}\r\n                                onChange={(e) => onVolumeChange(i, parseFloat(e.target.value))}\r\n                                style={{ width: '80px' }}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                ))}\r\n            </div>\r\n            {!allReady && <div className=\"muted\" style={{ textAlign: 'center', marginTop: '10px' }}>Loading Studio Stems...</div>}\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 618, "column": 0}, "map": {"version":3,"sources":["file:///F:/Projects/gemini-audio-engineer-react/frontend/src/components/MidiPreview.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useEffect, useRef } from \"react\";\r\n\r\ninterface MidiPreviewProps {\r\n    jobId: string;\r\n    midiFiles: string[];\r\n    validationReport?: string;\r\n}\r\n\r\nexport default function MidiPreview({ jobId, midiFiles, validationReport }: MidiPreviewProps) {\r\n    const canvasRef = useRef<HTMLCanvasElement>(null);\r\n\r\n    // For now, this is a placeholder visual. \r\n    // In a full implementation, we would parse the MIDI file bytes and draw notes.\r\n    useEffect(() => {\r\n        const ctx = canvasRef.current?.getContext(\"2d\");\r\n        if (!ctx) return;\r\n\r\n        const w = ctx.canvas.width;\r\n        const h = ctx.canvas.height;\r\n        ctx.clearRect(0, 0, w, h);\r\n\r\n        // Draw some \"fake\" piano roll nodes to represent data\r\n        ctx.fillStyle = \"rgba(45, 212, 191, 0.3)\";\r\n        for (let i = 0; i < 50; i++) {\r\n            const x = Math.random() * w;\r\n            const y = Math.random() * h;\r\n            const rw = Math.random() * 50 + 10;\r\n            ctx.fillRect(x, y, rw, 8);\r\n        }\r\n    }, [midiFiles]);\r\n\r\n    return (\r\n        <div className=\"card stack\" style={{ background: 'rgba(15, 23, 42, 0.5)', padding: '20px' }}>\r\n            <label style={{ color: 'var(--accent-secondary)' }}>üéπ MIDI Structure Preview</label>\r\n\r\n            <div style={{ position: 'relative', height: '200px', background: 'rgba(0,0,0,0.2)', borderRadius: '8px', overflow: 'hidden', border: '1px solid rgba(255,255,255,0.05)' }}>\r\n                <canvas ref={canvasRef} width={800} height={200} style={{ width: '100%', height: '100%' }} />\r\n                <div style={{ position: 'absolute', top: '10px', left: '10px', display: 'flex', gap: '8px', flexWrap: 'wrap' }}>\r\n                    {midiFiles.map(m => (\r\n                        <span key={m} className=\"pill\" style={{ background: 'rgba(129, 140, 248, 0.2)', fontSize: '0.65rem' }}>{m}</span>\r\n                    ))}\r\n                </div>\r\n            </div>\r\n\r\n            {validationReport && (\r\n                <div className=\"stack\" style={{ marginTop: '16px', gap: '8px' }}>\r\n                    <label style={{ fontSize: '0.7rem', color: '#fbbf24' }}>üìã Gemini Musical Validation Report</label>\r\n                    <div className=\"muted\" style={{\r\n                        fontSize: '0.8rem',\r\n                        padding: '12px',\r\n                        background: 'rgba(251, 191, 36, 0.05)',\r\n                        borderRadius: '6px',\r\n                        borderLeft: '3px solid #fbbf24',\r\n                        whiteSpace: 'pre-wrap',\r\n                        maxHeight: '150px',\r\n                        overflowY: 'auto'\r\n                    }}>\r\n                        {validationReport}\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;;;AAFA;;AAUe,SAAS,YAAY,EAAE,KAAK,EAAE,SAAS,EAAE,gBAAgB,EAAoB;;IACxF,MAAM,YAAY,IAAA,uKAAM,EAAoB;IAE5C,0CAA0C;IAC1C,+EAA+E;IAC/E,IAAA,0KAAS;iCAAC;YACN,MAAM,MAAM,UAAU,OAAO,EAAE,WAAW;YAC1C,IAAI,CAAC,KAAK;YAEV,MAAM,IAAI,IAAI,MAAM,CAAC,KAAK;YAC1B,MAAM,IAAI,IAAI,MAAM,CAAC,MAAM;YAC3B,IAAI,SAAS,CAAC,GAAG,GAAG,GAAG;YAEvB,sDAAsD;YACtD,IAAI,SAAS,GAAG;YAChB,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,IAAK;gBACzB,MAAM,IAAI,KAAK,MAAM,KAAK;gBAC1B,MAAM,IAAI,KAAK,MAAM,KAAK;gBAC1B,MAAM,KAAK,KAAK,MAAM,KAAK,KAAK;gBAChC,IAAI,QAAQ,CAAC,GAAG,GAAG,IAAI;YAC3B;QACJ;gCAAG;QAAC;KAAU;IAEd,qBACI,6LAAC;QAAI,WAAU;QAAa,OAAO;YAAE,YAAY;YAAyB,SAAS;QAAO;;0BACtF,6LAAC;gBAAM,OAAO;oBAAE,OAAO;gBAA0B;0BAAG;;;;;;0BAEpD,6LAAC;gBAAI,OAAO;oBAAE,UAAU;oBAAY,QAAQ;oBAAS,YAAY;oBAAmB,cAAc;oBAAO,UAAU;oBAAU,QAAQ;gBAAmC;;kCACpK,6LAAC;wBAAO,KAAK;wBAAW,OAAO;wBAAK,QAAQ;wBAAK,OAAO;4BAAE,OAAO;4BAAQ,QAAQ;wBAAO;;;;;;kCACxF,6LAAC;wBAAI,OAAO;4BAAE,UAAU;4BAAY,KAAK;4BAAQ,MAAM;4BAAQ,SAAS;4BAAQ,KAAK;4BAAO,UAAU;wBAAO;kCACxG,UAAU,GAAG,CAAC,CAAA,kBACX,6LAAC;gCAAa,WAAU;gCAAO,OAAO;oCAAE,YAAY;oCAA4B,UAAU;gCAAU;0CAAI;+BAA7F;;;;;;;;;;;;;;;;YAKtB,kCACG,6LAAC;gBAAI,WAAU;gBAAQ,OAAO;oBAAE,WAAW;oBAAQ,KAAK;gBAAM;;kCAC1D,6LAAC;wBAAM,OAAO;4BAAE,UAAU;4BAAU,OAAO;wBAAU;kCAAG;;;;;;kCACxD,6LAAC;wBAAI,WAAU;wBAAQ,OAAO;4BAC1B,UAAU;4BACV,SAAS;4BACT,YAAY;4BACZ,cAAc;4BACd,YAAY;4BACZ,YAAY;4BACZ,WAAW;4BACX,WAAW;wBACf;kCACK;;;;;;;;;;;;;;;;;;AAMzB;GAvDwB;KAAA"}},
    {"offset": {"line": 787, "column": 0}, "map": {"version":3,"sources":["file:///F:/Projects/gemini-audio-engineer-react/frontend/src/assets/logo.png.mjs%20%28structured%20image%20object%20with%20data%20url%29"],"sourcesContent":["import src from \"IMAGE\";\nexport default { src, width: 1024, height: 1024, blurWidth: 8, blurHeight: 8, blurDataURL: \"data:image/jpeg;base64,/9j/4AAQSkZJRgABAgAAAQABAAD/wAARCAAIAAgDAREAAhEBAxEB/9sAQwAKBwcIBwYKCAgICwoKCw4YEA4NDQ4dFRYRGCMfJSQiHyIhJis3LyYpNCkhIjBBMTQ5Oz4+PiUuRElDPEg3PT47/9sAQwEKCwsODQ4cEBAcOygiKDs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwDi4b/TF0Z43TNwRgHA64rqfJyK25jLn5lbY//Z\"};\n"],"names":[],"mappings":";;;;AAAA;;uCACe;IAAE,KAAA,0IAAG;IAAE,OAAO;IAAM,QAAQ;IAAM,WAAW;IAAG,YAAY;IAAG,aAAa;AAA63B"}},
    {"offset": {"line": 808, "column": 0}, "map": {"version":3,"sources":["file:///F:/Projects/gemini-audio-engineer-react/frontend/src/app/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useMemo, useState, useCallback, useRef, useEffect } from \"react\";\r\nimport Waveform from \"../components/Waveform\";\r\nimport { analyzeAudio, fetchSpectrogram, sendChatMessage, startAudioProcessing, getJobStatus } from \"../api\";\r\nimport StemPlayer from \"../components/StemPlayer\";\r\nimport MidiPreview from \"../components/MidiPreview\";\r\n\r\n\r\nimport logoImg from \"../assets/logo.png\";\r\nimport Image from \"next/image\";\r\n\r\ninterface ChatMessage {\r\n    role: \"user\" | \"model\";\r\n    text: string;\r\n    midiDownloadUrl?: string;\r\n}\r\n\r\nexport default function Page() {\r\n    const [file, setFile] = useState<File | null>(null);\r\n    const [selection, setSelection] = useState({ startSec: 0, endSec: 0, durationSec: 0 });\r\n    const [modelId, setModelId] = useState(\"gemini-3-pro-preview\");\r\n    const [temperature, setTemperature] = useState(0.2);\r\n    const [thinkingBudget, setThinkingBudget] = useState(0);\r\n    const [mode, setMode] = useState(\"engineer\");\r\n    const isGptAudio = modelId.startsWith(\"gpt-\");\r\n    const [prompt, setPrompt] = useState(\"\");\r\n    const ENGINEER_SUGGESTIONS = [\r\n        \"Check the overall frequency balance.\",\r\n        \"Are the vocals sitting correctly in the mix?\",\r\n        \"Evaluate the stereo width and mono compatibility.\",\r\n        \"Is the low-end (kick/bass) well-defined?\",\r\n        \"Suggest mastering moves for a commercial polish.\"\r\n    ];\r\n\r\n    const PRODUCER_SUGGESTIONS = [\r\n        \"Suggest additional layers to fill out the arrangement.\",\r\n        \"What bass line would complement these chords?\",\r\n        \"Recommend melodic counter-parts or harmonies.\",\r\n        \"What percussion layers would add energy?\",\r\n        \"Suggest synth textures or pad layers for depth.\"\r\n    ];\r\n\r\n    const SUGGESTIONS = mode === \"engineer\" ? ENGINEER_SUGGESTIONS : PRODUCER_SUGGESTIONS;\r\n    const [spectrogramB64, setSpectrogramB64] = useState(\"\");\r\n    const [sessionId, setSessionId] = useState<string | null>(null);\r\n    const [chatMessages, setChatMessages] = useState<ChatMessage[]>([]);\r\n    const [replyInput, setReplyInput] = useState(\"\");\r\n    const [error, setError] = useState(\"\");\r\n    const [loadingSpec, setLoadingSpec] = useState(false);\r\n    const [loadingAnalyze, setLoadingAnalyze] = useState(false);\r\n    const [loadingReply, setLoadingReply] = useState(false);\r\n\r\n    // Phase 1 Expansion State\r\n    const [jobId, setJobId] = useState<string | null>(null);\r\n    const [jobStatus, setJobStatus] = useState<any>(null);\r\n    const [jobLoading, setJobLoading] = useState(false);\r\n    const [pollingActive, setPollingActive] = useState(false);\r\n    const [profModel, setProfModel] = useState(\"demucs\");\r\n\r\n    const chatEndRef = useRef<HTMLDivElement>(null);\r\n\r\n\r\n    useEffect(() => {\r\n        chatEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n    }, [chatMessages]);\r\n\r\n    const canAct = useMemo(() => {\r\n        return !!file && selection.endSec > selection.startSec;\r\n    }, [file, selection]);\r\n\r\n    const onPickFile = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const f = e.target.files?.[0] || null;\r\n        setFile(f);\r\n        setChatMessages([]);\r\n        setSessionId(null);\r\n        setError(\"\");\r\n        setSpectrogramB64(\"\");\r\n    };\r\n\r\n    const onSelectionChange = useCallback((sel: { startSec: number; endSec: number; durationSec: number }) => {\r\n        setSelection(sel);\r\n    }, []);\r\n\r\n    const generateSpectrogram = async () => {\r\n        if (!file || !canAct) return;\r\n\r\n        setError(\"\");\r\n        setLoadingSpec(true);\r\n        try {\r\n            const data = await fetchSpectrogram({\r\n                file,\r\n                startSec: selection.startSec,\r\n                endSec: selection.endSec,\r\n            });\r\n            setSpectrogramB64(data.spectrogramPngBase64);\r\n        } catch (e: any) {\r\n            setError(e?.message || String(e));\r\n        } finally {\r\n            setLoadingSpec(false);\r\n        }\r\n    };\r\n\r\n    const runAnalysis = async () => {\r\n        if (!file || !canAct) return;\r\n\r\n        setError(\"\");\r\n        setLoadingAnalyze(true);\r\n        setChatMessages([]);\r\n        setSessionId(null);\r\n        try {\r\n            setChatMessages([{ role: \"user\", text: prompt }]);\r\n\r\n            const data = await analyzeAudio({\r\n                file,\r\n                startSec: selection.startSec,\r\n                endSec: selection.endSec,\r\n                prompt,\r\n                modelId,\r\n                temperature,\r\n                thinkingBudget,\r\n                mode,\r\n            });\r\n\r\n            setSessionId(data.sessionId);\r\n            setSpectrogramB64(data.spectrogramPngBase64);\r\n            setChatMessages(prev => [...prev, {\r\n                role: \"model\",\r\n                text: data.advice,\r\n                midiDownloadUrl: data.midiDownloadUrl\r\n            }]);\r\n        } catch (e: any) {\r\n            setError(e?.message || String(e));\r\n            setChatMessages(prev => prev.filter(m => m.text !== prompt));\r\n        } finally {\r\n            setLoadingAnalyze(false);\r\n        }\r\n    };\r\n\r\n    const sendReply = async () => {\r\n        if (!sessionId || !replyInput.trim()) return;\r\n        setLoadingReply(true);\r\n        const msg = replyInput;\r\n        setReplyInput(\"\");\r\n        setChatMessages(prev => [...prev, { role: \"user\", text: msg }]);\r\n        try {\r\n            const data = await sendChatMessage(sessionId, msg);\r\n            setChatMessages(prev => [...prev, {\r\n                role: \"model\",\r\n                text: data.reply,\r\n                midiDownloadUrl: data.midiDownloadUrl\r\n            }]);\r\n        } catch (e: any) {\r\n            setError(e?.message || String(e));\r\n        } finally {\r\n            setLoadingReply(false);\r\n        }\r\n    };\r\n\r\n    // Phase 1: Professional Pipeline Handlers\r\n    const runProfessionalPipeline = async () => {\r\n        if (!file) return;\r\n        setError(\"\");\r\n        setJobLoading(true);\r\n        setJobStatus(null);\r\n        try {\r\n            const data = await startAudioProcessing(file, profModel);\r\n            setJobId(data.job_id);\r\n            setPollingActive(true);\r\n        } catch (e: any) {\r\n\r\n            setError(e?.message || \"Failed to start pipeline\");\r\n        } finally {\r\n            setJobLoading(false);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        let timer: any;\r\n        if (pollingActive && jobId) {\r\n            const poll = async () => {\r\n                try {\r\n                    const status = await getJobStatus(jobId);\r\n                    setJobStatus(status);\r\n                    if (status.state === \"success\" || status.state === \"failed\") {\r\n                        setPollingActive(false);\r\n                    }\r\n                } catch (e) {\r\n                    console.error(\"Polling error\", e);\r\n                    setPollingActive(false);\r\n                }\r\n            };\r\n            poll();\r\n            timer = setInterval(poll, 3000);\r\n        }\r\n        return () => clearInterval(timer);\r\n    }, [pollingActive, jobId]);\r\n\r\n\r\n    return (\r\n        <div className=\"container\">\r\n            <header className=\"hero-section\">\r\n                <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '20px', marginBottom: '16px' }}>\r\n                    <Image src={logoImg} alt=\"App Logo\" className=\"app-logo\" width={64} height={64} priority />\r\n                    <h1>Mix Assistant AI</h1>\r\n                </div>\r\n            </header>\r\n            <div className=\"row\">\r\n                <div className=\"stack\">\r\n                    <section className=\"card stack\">\r\n                        <div>\r\n                            <label>1) Studio Source</label>\r\n                            <input type=\"file\" accept=\"audio/*\" onChange={onPickFile} />\r\n                            <div className=\"muted\" style={{ marginTop: '8px' }}>\r\n                                WAV / MP3 / FLAC supported.\r\n                            </div>\r\n                        </div>\r\n                        {file && (\r\n                            <>\r\n                                <div className=\"hr\" />\r\n                                <div>\r\n                                    <label>2) Signal Selection</label>\r\n                                    <Waveform file={file} onSelectionChange={onSelectionChange} />\r\n                                </div>\r\n\r\n                                <div className=\"kpi\">\r\n                                    <span className=\"pill\">Start: {selection.startSec.toFixed(2)}s</span>\r\n                                    <span className=\"pill\">End: {selection.endSec.toFixed(2)}s</span>\r\n                                    <span className=\"pill\">Region: {(selection.endSec - selection.startSec).toFixed(2)}s</span>\r\n                                </div>\r\n                            </>\r\n                        )}\r\n                    </section>\r\n                    <section className=\"card spectrogram-card\">\r\n                        <label>Spectrogram Reference</label>\r\n                        {spectrogramB64 ? (\r\n                            <img src={`data:image/png;base64,${spectrogramB64}`} alt=\"Spectrogram\" />\r\n                        ) : (\r\n                            <div className=\"spectrogram-placeholder\">\r\n                                <div className=\"muted\">Visual data will appear after analysis</div>\r\n                            </div>\r\n                        )}\r\n                    </section>\r\n                </div>\r\n                <div className=\"stack\">\r\n                    <section className=\"card stack\">\r\n                        <div className=\"row\" style={{ gridTemplateColumns: \"1fr 1fr\", gap: '8px', marginBottom: '12px' }}>\r\n                            <button\r\n                                className={`btn ${mode === \"engineer\" ? \"\" : \"secondary\"}`}\r\n                                onClick={() => !sessionId && setMode(\"engineer\")}\r\n                                disabled={!!sessionId}\r\n                                style={{ opacity: sessionId ? 0.6 : 1 }}\r\n                            >\r\n                                üéõÔ∏è Engineer\r\n                            </button>\r\n                            <button\r\n                                className={`btn ${mode === \"producer\" ? \"\" : \"secondary\"}`}\r\n                                onClick={() => !sessionId && setMode(\"producer\")}\r\n                                disabled={!!sessionId}\r\n                                style={{ opacity: sessionId ? 0.6 : 1 }}\r\n                            >\r\n                                üéπ Producer\r\n                            </button>\r\n                        </div>\r\n                        <div className=\"row\" style={{ gridTemplateColumns: \"1fr 1fr 1fr\", gap: '12px' }}>\r\n                            <div>\r\n                                <label>Model</label>\r\n                                <select value={modelId} onChange={(e) => setModelId(e.target.value)}>\r\n                                    {/* Option 1: The Reliable Workhorses (Use these to avoid errors) */}\r\n                                    <optgroup label=\"Recommended (Stable & Fast)\">\r\n                                        <option value=\"gemini-2.0-flash\">Gemini 2.0 Flash (Best Balance)</option>\r\n                                        <option value=\"gemini-2.0-flash-lite-preview-02-05\">Gemini 2.0 Flash Lite (Fastest)</option>\r\n                                    </optgroup>\r\n\r\n                                    {/* Option 2: High Intelligence (May hit rate limits) */}\r\n                                    <optgroup label=\"High Intelligence (Pro)\">\r\n                                        <option value=\"gemini-2.5-pro\">Gemini 2.5 Pro</option>\r\n                                        <option value=\"gemini-2.5-flash\">Gemini 2.5 Flash</option>\r\n                                    </optgroup>\r\n\r\n                                    {/* Option 3: Experimental / Bleeding Edge (Expect 429 Errors) */}\r\n                                    <optgroup label=\"Experimental (Low Rate Limits)\">\r\n                                        <option value=\"gemini-3-pro-preview\">Gemini 3 Pro Preview</option>\r\n                                        <option value=\"gemini-3-flash-preview\">Gemini 3 Flash Preview</option>\r\n                                        <option value=\"gemini-2.0-flash-exp\">Gemini 2.0 Flash Experimental</option>\r\n                                    </optgroup>\r\n\r\n                                    {/* Option 4: Open Models (Text Focused) */}\r\n                                    <optgroup label=\"Open Models\">\r\n                                        <option value=\"gemma-3-27b-it\">Gemma 3 (27B)</option>\r\n                                    </optgroup>\r\n                                </select>\r\n                            </div>\r\n                            <div>\r\n                                <label>Style</label>\r\n                                <select\r\n                                    value={temperature}\r\n                                    onChange={(e) => setTemperature(Number(e.target.value))}\r\n                                >\r\n                                    <option value={0.1}>Focused</option>\r\n                                    <option value={0.4}>Balanced</option>\r\n                                    <option value={0.7}>Creative</option>\r\n                                    <option value={1.0}>Unusual</option>\r\n                                </select>\r\n                            </div>\r\n                            <div>\r\n                                <label style={{ opacity: isGptAudio ? 0.5 : 1 }}>Thinking {isGptAudio && <span style={{ fontSize: '0.7em', color: '#fbbf24' }}>(N/A)</span>}</label>\r\n                                <select\r\n                                    value={isGptAudio ? 0 : thinkingBudget}\r\n                                    onChange={(e) => setThinkingBudget(Number(e.target.value))}\r\n                                    disabled={isGptAudio}\r\n                                    style={{ opacity: isGptAudio ? 0.5 : 1 }}\r\n                                >\r\n                                    <option value={0}>None</option>\r\n                                    <option value={1024}>Low</option>\r\n                                    <option value={4096}>Medium</option>\r\n                                    <option value={8192}>High</option>\r\n                                </select>\r\n                            </div>\r\n                        </div>\r\n                        {isGptAudio && (\r\n                            <div className=\"muted\" style={{ fontSize: '0.8em', padding: '8px 12px', background: 'rgba(251, 191, 36, 0.1)', borderRadius: '6px', borderLeft: '3px solid #fbbf24' }}>\r\n                                <strong style={{ color: '#fbbf24' }}>GPT Audio Mode:</strong> Spectrogram image will not be sent (audio-only analysis). Thinking mode is not available.\r\n                            </div>\r\n                        )}\r\n                        <div className=\"hr\" />\r\n                        <div>\r\n                            <label>3) Engineer Directives</label>\r\n                            <textarea\r\n                                value={prompt}\r\n                                onChange={(e) => setPrompt(e.target.value)}\r\n                                disabled={!!sessionId}\r\n                                placeholder=\"Describe the style and direction...\"\r\n                                style={{ minHeight: '80px' }}\r\n                            />\r\n                            <div className=\"kpi\" style={{ marginTop: \"10px\", gap: \"6px\" }}>\r\n                                {SUGGESTIONS.map((s, i) => (\r\n                                    <button\r\n                                        key={i}\r\n                                        className=\"suggestion-pill\"\r\n                                        onClick={() => !sessionId && setPrompt(s)}\r\n                                        disabled={!!sessionId}\r\n                                    >\r\n                                        {s}\r\n                                    </button>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"row\" style={{ gridTemplateColumns: \"1fr 1fr\", gap: '12px' }}>\r\n                            <button className=\"btn secondary\" disabled={!canAct || loadingSpec} onClick={generateSpectrogram}>\r\n                                {loadingSpec ? \"Rendering...\" : \"Preview\"}\r\n                            </button>\r\n                            <button className=\"btn\" disabled={!canAct || loadingAnalyze || !!sessionId} onClick={runAnalysis}>\r\n                                {loadingAnalyze ? (\r\n                                    <span className=\"loading-text\">Analyzing...</span>\r\n                                ) : !!sessionId ? (\r\n                                    \"Session Live\"\r\n                                ) : (\r\n                                    \"Start Analysis\"\r\n                                )}\r\n                            </button>\r\n                        </div>\r\n\r\n                        <div className=\"hr\" style={{ margin: '20px 0 10px 0' }} />\r\n\r\n                        <div className=\"stack\" style={{ gap: '10px' }}>\r\n                            <label style={{ color: 'var(--accent-secondary)' }}>üéπ Professional Expansion (Beta)</label>\r\n                            <p style={{ fontSize: '0.85rem' }}>Extract deep stems and polyphonic MIDI from the full track.</p>\r\n\r\n                            <div className=\"row\" style={{ gridTemplateColumns: \"1fr 1fr\", gap: '12px', alignItems: 'center' }}>\r\n                                <div>\r\n                                    <label style={{ fontSize: '0.7rem' }}>Model</label>\r\n                                    <select\r\n                                        value={profModel}\r\n                                        onChange={(e) => setProfModel(e.target.value)}\r\n                                        disabled={jobLoading || pollingActive}\r\n                                        style={{ width: '100%' }}\r\n                                    >\r\n                                        <option value=\"demucs\">Demucs v4 (Balanced)</option>\r\n                                        <option value=\"umx\">Open-Unmix (Clean Vocals)</option>\r\n                                    </select>\r\n                                </div>\r\n                                <button\r\n                                    className=\"btn secondary\"\r\n                                    style={{ borderColor: 'var(--accent-secondary)', color: 'var(--accent-secondary)', marginTop: '20px' }}\r\n                                    disabled={!file || jobLoading || pollingActive}\r\n                                    onClick={runProfessionalPipeline}\r\n                                >\r\n                                    {jobLoading ? \"...\" : pollingActive ? \"Processing...\" : \"Start Deep Extraction\"}\r\n                                </button>\r\n                            </div>\r\n\r\n\r\n                            {jobStatus && (\r\n                                <div className=\"card\" style={{ padding: '12px', background: 'rgba(45, 212, 191, 0.05)', borderColor: 'var(--accent-secondary)' }}>\r\n                                    <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '8px' }}>\r\n                                        <span style={{ fontSize: '0.8rem', fontWeight: 600 }}>Status: {jobStatus.state.toUpperCase()}</span>\r\n                                        <span style={{ fontSize: '0.8rem' }}>{jobStatus.progress}%</span>\r\n                                    </div>\r\n                                    <div style={{ height: '4px', background: 'rgba(255,255,255,0.1)', borderRadius: '2px', overflow: 'hidden' }}>\r\n                                        <div style={{ height: '100%', width: `${jobStatus.progress}%`, background: 'var(--accent-secondary)', transition: 'width 0.5s ease' }} />\r\n                                    </div>\r\n                                    <div className=\"muted\" style={{ marginTop: '8px', fontSize: '0.75rem' }}>{jobStatus.message}</div>\r\n\r\n                                    {jobStatus.state === \"success\" && (\r\n                                        <div className=\"stack\" style={{ marginTop: '20px', gap: '24px' }}>\r\n                                            <StemPlayer\r\n                                                stems={jobStatus.artifacts.stems.map((s: string) => ({\r\n                                                    name: s.replace(\".wav\", \"\"),\r\n                                                    url: `http://localhost:8000/audio_jobs/${jobId}/stems/${s}`\r\n                                                }))}\r\n                                            />\r\n\r\n                                            <MidiPreview\r\n                                                jobId={jobId!}\r\n                                                midiFiles={jobStatus.artifacts.midi}\r\n                                                validationReport={jobStatus.validation_report}\r\n                                            />\r\n\r\n                                            <div className=\"card\" style={{ background: 'rgba(45, 212, 191, 0.1)', borderColor: 'var(--accent-secondary)' }}>\r\n                                                <div className=\"row\" style={{ justifyContent: 'space-between', alignItems: 'center' }}>\r\n                                                    <div className=\"stack\" style={{ gap: '4px' }}>\r\n                                                        <label style={{ color: 'var(--accent-secondary)' }}>üèÅ DAW Ready: REAPER Project</label>\r\n                                                        <p style={{ fontSize: '0.75rem' }}>Full session with stems and MIDI tracks mapped and ready.</p>\r\n                                                    </div>\r\n                                                    <a\r\n                                                        href={`http://localhost:8000/audio_jobs/${jobId}/${jobStatus.artifacts.project[0]}`}\r\n                                                        download\r\n                                                        className=\"btn\"\r\n                                                        style={{ background: 'var(--accent-secondary)', color: '#000' }}\r\n                                                    >\r\n                                                        EXPORT TO REAPER (.RPP)\r\n                                                    </a>\r\n                                                </div>\r\n                                            </div>\r\n\r\n                                            <div className=\"stack\" style={{ gap: '8px' }}>\r\n                                                <label style={{ fontSize: '0.7rem' }}>Individual Raw Artifacts</label>\r\n                                                <div className=\"row\" style={{ gridTemplateColumns: '1fr 1fr', gap: '8px' }}>\r\n                                                    <div className=\"stack\" style={{ gap: '4px' }}>\r\n                                                        <span style={{ fontSize: '0.65rem' }}>Stems</span>\r\n                                                        {jobStatus.artifacts.stems.map((s: string) => (\r\n                                                            <a key={s} href={`http://localhost:8000/audio_jobs/${jobId}/stems/${s}`} download className=\"pill\" style={{ textAlign: 'center', textDecoration: 'none', fontSize: '10px' }}>{s}</a>\r\n                                                        ))}\r\n                                                    </div>\r\n                                                    <div className=\"stack\" style={{ gap: '4px' }}>\r\n                                                        <span style={{ fontSize: '0.65rem' }}>MIDI</span>\r\n                                                        {jobStatus.artifacts.midi.map((m: string) => (\r\n                                                            <a key={m} href={`http://localhost:8000/audio_jobs/${jobId}/midi/${m}`} download className=\"pill\" style={{ textAlign: 'center', textDecoration: 'none', background: 'rgba(129, 140, 248, 0.1)', fontSize: '10px' }}>{m}</a>\r\n                                                        ))}\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n\r\n                                    )}\r\n\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n\r\n                        {error && (\r\n                            <div className=\"card\" style={{ background: \"rgba(239, 68, 68, 0.1)\", borderColor: \"rgba(239, 68, 68, 0.2)\" }}>\r\n                                <label style={{ color: \"#ef4444\" }}>Error Occurred</label>\r\n                                <div className=\"muted\" style={{ color: \"#fca5a5\" }}>{error}</div>\r\n                            </div>\r\n                        )}\r\n                    </section>\r\n                    <section className=\"card chat-container\">\r\n                        <label>{mode === \"engineer\" ? \"Engineer Consultation\" : \"Producer Session\"}</label>\r\n                        <div className=\"chat-messages\">\r\n                            {chatMessages.length === 0 && (\r\n                                <div className=\"muted\" style={{ textAlign: \"center\", marginTop: \"40px\" }}>\r\n                                    Consultation inactive. Start analysis to begin chat.\r\n                                </div>\r\n                            )}\r\n                            {chatMessages.map((msg, idx) => (\r\n                                <div key={idx} className={`message ${msg.role}`}>\r\n                                    <div className=\"message-label\">\r\n                                        {msg.role === \"user\" ? \"You\" : (mode === \"engineer\" ? \"Engineer\" : \"Producer\")}\r\n                                    </div>\r\n                                    <div style={{ whiteSpace: 'pre-wrap' }}>{msg.text}</div>\r\n                                    {msg.midiDownloadUrl && (\r\n                                        <div className=\"midi-attachment\">\r\n                                            <div className=\"midi-header\">\r\n                                                <span className=\"midi-icon\">üéπ</span>\r\n                                                <span className=\"midi-title\">MIDI File Generated</span>\r\n                                            </div>\r\n                                            <a\r\n                                                href={`http://localhost:8000${msg.midiDownloadUrl}`}\r\n                                                download\r\n                                                className=\"btn midi-download-btn\"\r\n                                            >\r\n                                                Download .MID File\r\n                                            </a>\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            ))}\r\n                            <div ref={chatEndRef} />\r\n                        </div>\r\n                        <div className=\"chat-input-wrapper\">\r\n                            <input\r\n                                className=\"chat-input\"\r\n                                type=\"text\"\r\n                                placeholder={sessionId ? \"Ask follow-up...\" : \"Analysis required...\"}\r\n                                value={replyInput}\r\n                                onChange={e => setReplyInput(e.target.value)}\r\n                                onKeyDown={e => e.key === \"Enter\" && !e.shiftKey && sendReply()}\r\n                                disabled={!sessionId || loadingReply}\r\n                            />\r\n                            <button\r\n                                className=\"btn\"\r\n                                disabled={!sessionId || loadingReply || !replyInput.trim()}\r\n                                onClick={sendReply}\r\n                            >\r\n                                {loadingReply ? \"...\" : \"Send\"}\r\n                            </button>\r\n                        </div>\r\n                    </section>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}"],"names":[],"mappings":"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"}}]
}